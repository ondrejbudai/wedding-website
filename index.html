<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Marie a Ondřej</title>
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display+SC&display=swap"
          rel="stylesheet">

    <style>
        @font-face {
            font-family: 'Playfair Display';
            src: url('playfairdisplay-variablefontwght-webfont.woff2') format('woff2'),
            url('playfairdisplay-variablefontwght-webfont.woff') format('woff'),
            url('playfairdisplay-variablefontwght-webfont.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-feature-settings: 'pnum' on, 'lnum' on;

        }

        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 24px;
            font-family: 'Playfair Display', serif;
            color: #505050;
        }

        section {
            width: 800px;
            margin-bottom: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        section p {
            text-align: justify;
        }

        section.important {
        }

        article.important > p, section.important > p {
            text-align: center;
            font-size: 36px;
            color: #505050;
            width: 600px;
        }

        section.important p.less-important {
            font-size: 24px;
        }

        article {
            margin-bottom: 80px;
            align-self: stretch;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        article:last-child {
            margin-bottom: 0;
        }

        p + article {
            margin-top: 40px;
        }

        p {
            margin-top: 0;
            margin-bottom: 1.5em;
            width: 100%;
        }

        p.less-margin {
            margin-bottom: 0.5em;
        }

        p:last-child {
            margin-bottom: 0;
        }

        header {
            display: flex;
            flex-direction: row;
            margin: 30px 0;
        }

        header img {
            width: 80px;
            margin: 80px 0;
        }

        header img:first-child {
            transform: scaleX(-1);
        }

        h1 {
            font-family: 'Playfair Display SC', serif;
            letter-spacing: 0.1em;
            font-size: 72px;
            text-align: center;
            font-weight: normal;
            margin: 0;
            color: black;
        }

        h1 span {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            display: block;
        }

        h2 {
            font-size: 48px;
            font-weight: normal;
            color: #505050;
            font-family: 'Playfair Display', serif;
            margin: 0 0 40px;
        }

        #main-photo {
            height: 512px;
            width: 100%;
            object-fit: cover;
            margin-bottom: 40px;
        }

        h3 {
            font-family: 'Playfair Display SC', serif;
            font-size: 48px;
            font-weight: normal;
            margin: 0 0 40px;
            color: #1e1e1e;
            text-align: center;
        }

        h4 {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            font-weight: normal;
            margin: 0 0 40px;
            color: #1e1e1e;
            text-align: center;
        }

        .plan {
            list-style: none;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .plan::before {
            content: '';
            position: absolute;
            display: block;
            height: calc(100% - 22px);
            width: 0;
            border-left: 4px solid #ffcaca;
            z-index: -1;
            margin-top: 11px;
        }

        .plan.plan-alt-color::before {
            border-left: 4px solid #b2ccff;
        }

        .plan > li {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .plan > li:last-child {
            margin-bottom: 0;
        }

        .plan > li::before {
            content: '';
            margin-left: -9px;
            display: block;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            background-color: #ff6c6c;
            margin-right: 50px;
        }

        .plan.plan-alt-color > li::before {
            background-color: #4b88ff;
        }

        .plan > li > .time {
            width: 150px;
        }

        .plan > li span:last-child {
            width: 300px;
        }

        #move {
            margin: -30px 0 40px 0;
            color: #6f6f6f;
        }

        .map {
            width: 600px;
            margin-bottom: 30px;
        }

        .map-dynamic {
            height: 500px;
        }

        .gift-table td {
            padding: 0 30px 20px;
            vertical-align: baseline;
        }

        .gift-table tr:last-child td {
            padding-bottom: 0;
        }

        .gift-table td:first-child {
            padding-left: 0;
        }

        .gift-table td:last-child {
            padding-right: 0;
        }

        .gift-table td:nth-child(2) {
            text-align: right;
            color: #6f6f6f;
        }

        a {
            color: #31b5ff;
        }

        a:hover {
            text-decoration: none;
        }

        button {
            background-color: #0073ff;
            transition: background-color 150ms ease-in-out;
            border: none;
            color: white;
            border-radius: 5px;
            padding: 5px 10px;
            font-family: 'Playfair Display', serif;
            font-size: 18px;
        }

        button:hover {
            cursor: pointer;
            background-color: #004897;
        }

        button:focus {
            box-shadow: 0 0 0 4px #6fb3f1;
        }

        button::-moz-focus-inner {
            border: 0;
        }

        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #modal .modal-content {
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            border: #6f6f6f;
            border-radius: 5px;
        }

        #modal .modal-content h5 {
            font-size: 36px;
            color: black;
            font-weight: normal;
            margin: 0 0 40px;
        }

        #modal .modal-content .modal-text {
            font-size: 18px;
            text-align: center;
            margin-bottom: 40px;
        }

        #modal .modal-content button {
            width: 200px;
            font-size: 24px;
            margin: 0 10px;
        }

        #modal .modal-content button.cancel {
            background-color: #6f6f6f;
        }

        #modal .modal-content button.cancel:hover {
            background-color: #444444;
        }

        #modal .modal-content .donate {
            margin-bottom: 40px;
        }

        #modal .modal-content .donate {
            display: flex;
        }

        #modal .modal-content .input-donate {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            width: 80px;
            margin: 0 5px 0 10px;
            height: 33px;
            border-bottom: 1px solid black;
            text-align: right;
        }

        .body-modal-open {
            overflow: hidden;
        }

        input[type=number] {
            border: none;
            border-bottom: 1px solid black;
            font-size: 24px;
            -moz-appearance: textfield;
            text-align: right;
            width: 70px;
            font-family: 'Playfair Display', serif;
            outline: none;
        }

        input[type=number]:focus {
            box-shadow: none;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .text-align-center {
            text-align: center;
        }
    </style>
</head>
<body>
<header>
    <img src="./bird.svg" alt="">
    <h1>
        Marie
        <span>a</span>
        Ondřej
    </h1>
    <img src="./bird.svg" class="right" alt="">
</header>

<h2>20. 6. 2020</h2>

<img id="main-photo" src="./horalové.jpg" alt="">

<section>
    <h3>Novinky</h3>
    <p>
        Přidali jsme k obřadu i k veselce mapku s parkováním. K občerstvení jsme přidali informace o pití. Ve zkratce:
        nealko, pivo a víno bude volně, tvrdý alkohol za peníze na baru. A dobrá zpráva pro všechny přespávající: Máme
        dostatek pokojů pro všechny, spacáky tedy netřeba.
    </p>
</section>

<section class="important">
    <h3>Časový plán</h3>
    <article>
        <h4>Obřad</h4>
        <ul class="plan">
            <li><span class="time">11:30</span><span>Sraz účastníků</span></li>
            <li><span class="time">12:00</span><span>Svatební obřad</span></li>
            <li><span class="time">12:45</span><span>Fotografování</span></li>
        </ul>
    </article>
    <div id="move">~ Přesun do Josefova Dolu ~</div>
    <article>
        <h4>Veselka</h4>
        <ul class="plan plan-alt-color">
            <li><span class="time">14:00</span><span>Začátek rautu</span></li>
            <li><span class="time">16:00</span><span>Krájení svatebního dortu</span></li>
            <li><span class="time">17:00</span><span>Předání svatebních darů</span></li>
            <li><span class="time">18:00</span><span>Báseň pro novomanžele</span></li>
            <li><span class="time">19:00</span><span>První novomanželský tanec</span></li>
            <li><span class="time">19:30+</span><span>Volná zábava s hudbou</span></li>
        </ul>
    </article>
    <article>
        <p class="less-important">
            V průběhu celého odpoledne pro Vás bude k dispozici několik zahradních her. Pro děti je na místě prolézačka
            se skluzavkou, v případě teplého počasí i brouzdaliště.
        </p>
    </article>
</section>


<section class="important">
    <h3>Obřad</h3>
    <p>
        začíná ve 12 hodin na louce u kostela Matky Boží U Obrázku v libereckých Ruprechticích.
    </p>
    <p class="less-important">
        V případě nepřízně počasí proběhne obřad v kostele.
    </p>
    <article>
        <h4>Mapa a souřadnice</h4>
        <div id="map-obrad" class="map map-dynamic"></div>
        <p class="text-align-center">50.7943283N, 15.0775258E</p>
    </article>
    <article>
        <h4>Parkování</h4>
        <a href="parking-map-obrad.jpg"><img src="parking-map-obrad.jpg" class="map"></a>
        <p>
            Místa přímo na louce jsou vyhrazena rodině (brána bude otevřená). Ostatní mohou parkovat na točně (prosím,
            zachovejte její průjezdnost) nebo v Krakonošově ulici (na místě budeme mít našeho parkovacího koordinátora).
        </p>
    </article>
</section>
<section>
    <h3>Veselka</h3>
    <p>
        Po obřadu se svatba přesune do penzionu Ráj v Josefově Dole, který je pro nás celý k dispozici až do neděle.
    </p>

    <article>
        <h4>Mapa a souřadnice</h4>
        <div id="map-veselka" class="map map-dynamic"></div>
        <p class="text-align-center">Josefův Důl 951<br>50.7847092N, 15.2425031E</p>
    </article>

    <article>
        <h4>Parkování</h4>
        <a href="parking-map-veselka.jpg"><img src="parking-map-veselka.jpg" class="map"></a>
        <p>
            Lidi, kteří zůstávají do neděle, prosíme, aby parkovali v lese, neboť u penzionu není dostatek místa.
            Ostatní mohou parkovat před penzionem, případně u rybníčku.
        </p>
    </article>

    <article>
        <h4>Ubytování</h4>
        <p>
            Podařilo se nám všechny, kteří měli zájem o ubytování, poskládat do pokojů a není třeba, abyste si proto
            vozili spacáky.
        </p>
    </article>

    <article>
        <h4>Stravování</h4>
        <p>
            Rozhodli jsme se, že nechceme odpoledne zbytečně komplikovat, proto na naší svatbě rodinný oběd nečekejte.
            Místo toho bude pro všechny v průběhu odpoledne k dispozici raut, při kterém si každý přijde na své. Pokud
            máte nějaké dietní požadavky, dejte nám vědět, ať Vám můžeme co nejlépe vyhovět.
        </p>
        <p>
            Celé odpoledne a večer bude volně k dispozici nealko, pivo a víno. Pokud Vás zrovna nepozveme na jednu rundu,
            pak bude tvrdý alkohol na baru za úplatu.
        </p>
        <p>
            V neděli ráno pak na Vás bude čekat snídaně.
        </p>
    </article>

    <article>
        <h4>Vaše účast a doprava</h4>
        <p>
            Rádi Vás uvidíme na všech částech naší svatby, ovšem pochopíme, pokud se některé části nebudete chtít
            zúčastnit.
        </p>
        <p>

            V případě, že budete chtít z odpoledního programu odjet dříve, budeme mít k dispozici řidiče s autem, který
            Vás
            dopraví z Josefova Dolu do Liberce a okolí. Prosíme Vás, abyste se nám v tomto případě co nejdříve ozvali,
            abychom
            mohli tyto přesuny naplánovat.
        </p>
    </article>
</section>
<section>
    <h3>Svatební dary</h3>
    <p>
        Rádi bychom nejprve připomněli, že dar není v žádném případě povinnost, jsme moc rádi už jenom za to, že na
        naši svatbu dorazíte.
    </p>
    <p>
        Nicméně jsme již slyšeli, že někteří nám opravdu chcete něco dát. Pro tyto případy máme následující seznam, ve
        kterém si můžete zarezervovat, čím byste nás chtěli obdarovat. Pod modrým podtrženým textem naleznete odkaz na
        námi preferovaný dar.
    </p>
    <article>
        <h4>Seznam možných darů</h4>
        <p id="gift-table-loading">
            Načítám...
        </p>
        <table id="gift-table" class="gift-table">
            <tbody>
            </tbody>
        </table>

    </article>
</section>
<section>
    <h3>Kontakty</h3>
    <article class="important">
        <h4>Nevěsta</h4>
        <p class="less-margin">
            majkauhlirova@email.cz
        </p>
        <p>
            739 769 263
        </p>
    </article>
    <article class="important">
        <h4>Ženich</h4>
        <p class="less-margin">
            ondrej@budai.cz
        </p>
        <p class="less-margin">
            739 865 094
        </p>
    </article>
</section>
<div id="modal">
    <div class="modal-content">
        <h5 class="modal-header">Opravdu nám chceš dát 6 skleniček na červené?</h5>
        <div class="donate">
            <div>Zadej kolik:</div>
            <div><input type="number" class="input-donate" min="1"></div>
            <div>Kč</div>
        </div>
        <p class="modal-text modal-donation-info">Žádnou platební bránu nemáme, prostě si to předáme osobně. :)</p>
        <p class="modal-text">Jakmile klikneš na ano, už to nelze vrátit...</p>
        <div class="modal-buttons">
            <button class="submit">Ano!</button>
            <button class="cancel" onclick="hideModal()">Ne</button>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://api.mapy.cz/loader.js"></script>
<script type="text/javascript">Loader.load();</script>
<script>
    function initMapObrad() {
        var center = SMap.Coords.fromWGS84(15.0722006, 50.7922547);
        var m = new SMap(JAK.gel("map-obrad"), center, 16);
        m.addDefaultLayer(SMap.DEF_BASE).enable();


        var layer = new SMap.Layer.Marker();
        m.addLayer(layer);
        layer.enable();

        var options = {};
        var marker = new SMap.Marker(SMap.Coords.fromWGS84(15.0743428, 50.7946947), "Kostel", options);
        layer.addMarker(marker);
    }

    function initMapVeselka() {
        var center = SMap.Coords.fromWGS84(15.2405467, 50.7827283);
        var m = new SMap(JAK.gel("map-veselka"), center, 15);
        m.addDefaultLayer(SMap.DEF_BASE).enable();


        var layer = new SMap.Layer.Marker();
        m.addLayer(layer);
        layer.enable();

        var options = {};
        var marker = new SMap.Marker(SMap.Coords.fromWGS84(15.2425853, 50.7847519), "Penzion", options);
        layer.addMarker(marker);
    }

    initMapObrad();
    initMapVeselka();
</script>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.12.0/firebase-firestore.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyD8e6uHC37oX4yyuJzJhrDR3OJdlVumha8",
        authDomain: "wedding-website-271817.firebaseapp.com",
        databaseURL: "https://wedding-website-271817.firebaseio.com",
        projectId: "wedding-website-271817",
        storageBucket: "wedding-website-271817.appspot.com",
        messagingSenderId: "337939590578",
        appId: "1:337939590578:web:9e20714f7e0bad2def88ab"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const giftTable = document.getElementById("gift-table").children[0];
    const giftTableLoading = document.getElementById("gift-table-loading");

    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function formatPrice(price) {
        const thousands = Math.floor(price / 1000);

        if (thousands > 0) {
            const rest = price - thousands * 1000;
            const restStr = rest.toString().padStart(3, "0");
            return `${thousands} ${restStr}`;
        }

        return `${price}`;
    }

    function addGiftToGiftTable(giftTable, gift, giftId) {
        const localGifts = getLocalGiftsFromCookies();
        const row = document.createElement("tr")
        for (let i = 0; i < 3; i++) {
            row.appendChild(document.createElement("td"))
        }
        row.children[0].innerHTML = `<a href="${gift.link}" target="_blank">${gift.name}</a>`;
        if (gift.taken === undefined) {
            row.children[1].textContent = `${formatPrice(gift.collected)} / ${formatPrice(gift.price)} Kč`;
        } else {
            row.children[1].textContent = formatPrice(gift.price) + ' Kč';
        }

        if (gift.taken) {
            if (localGifts.includes(giftId)) {
                row.children[2].textContent = '✓ Toto sis vybral(a)';
            } else {
                row.children[2].textContent = 'Už rezervované';
            }

        } else if (gift.taken === undefined && gift.collected === gift.price) {
            row.children[2].textContent = 'Už vybrané';
        } else {
            const button = document.createElement("button");
            button.onclick = () => {
                showModal(giftId, gift);
            }

            if (gift.taken === undefined) {
                button.innerText = "Na to chci přispět!";
            } else {
                button.innerText = "To Vám chci dát!";
            }

            row.children[2].appendChild(button);
        }


        giftTable.appendChild(row);
    }

    function donateToGift(giftId, gift, amount) {
        hideModal();
        setGiftTableLoading(true);

        const giftRef = db.collection("gifts").doc(giftId);
        giftRef.set({
            collected: gift.collected + amount
        }, {merge: true})
            .then(load)
            .then(() => setGiftTableLoading(false))
            .then(() => {
                return log({
                    type: "donateToGift",
                    id: giftId,
                    amount: amount,
                    pre: gift.collected,
                    post: gift.collected + amount,
                });
            });
    }

    function getLocalGiftsFromCookies() {
        const localGiftsStr = getCookie("localGifts");
        if (localGiftsStr === null) {
            return [];
        }
        return localGiftsStr.split(",");
    }

    function takeGift(giftId) {
        hideModal();
        setGiftTableLoading(true);

        const giftRef = db.collection("gifts").doc(giftId);
        giftRef.set({
            taken: true
        }, {merge: true})
            .then(() => {
                let localGifts = getLocalGiftsFromCookies();

                localGifts.push(giftId);
                const newLocalGiftsStr = localGifts.join(",");
                setCookie("localGifts", newLocalGiftsStr, 1000);
            })
            .then(load)
            .then(() => setGiftTableLoading(false))
            .then(() => {
                return log({
                    type: "takeGift",
                    id: giftId,
                    pre: false,
                    post: true,
                });
            });
    }

    function setGiftTableLoading(loading) {
        if (loading) {
            giftTable.style.display = "none";
            giftTableLoading.style.display = "block";
        } else {
            giftTable.style.display = "table";
            giftTableLoading.style.display = "none";
        }
    }

    function load() {
        return new Promise((resolve) => {
            giftTable.textContent = '';
            db.collection("gifts").orderBy('price', 'asc').get().then((gifts) => {
                gifts.forEach((giftRef) => {
                    const gift = giftRef.data();
                    addGiftToGiftTable(giftTable, gift, giftRef.id);
                })
                resolve();
            })
        });
    }

    window.onload = () => {
        load().then(() => {
            setGiftTableLoading(false);
        });
    };

    document.body.onkeydown = (e) => {
        if (e.key === "Escape") {
            hideModal();
        }
    }

    function log(data) {
        const date = new Date().toISOString();
        return db.collection("logs").doc(date).set(data)
    }

    const modal = document.getElementById("modal");
    const modalHeader = modal.getElementsByClassName("modal-header")[0];
    const modalSubmit = document.getElementsByClassName("submit")[0];
    const modalDonate = document.getElementsByClassName("donate")[0];
    const modalDonateInput = document.getElementsByClassName("input-donate")[0];
    const modalDonateInfo = document.getElementsByClassName("modal-donation-info")[0];

    function betterParseUint(str) {
        if (/^[0-9]+$/.test(str)) {
            return Number(str);
        }

        return NaN;
    }

    function showModal(giftId, gift) {
        modal.style.display = "flex";
        modalDonate.style.display = "none";
        modalDonateInfo.style.display = "none";
        document.body.classList.add("body-modal-open");

        if (gift.taken === undefined) {
            modalHeader.innerText = `Opravdu nám chceš přispět na ${gift.modal}?`;
            modalDonate.style.display = "flex";
            modalDonateInfo.style.display = "block";
            modalDonateInput.max = gift.price - gift.collected;
            const sendFn = () => {
                const amountInput = modalDonateInput.value;
                modalDonateInput.value = "";
                const amount = betterParseUint(amountInput)
                if (isNaN(amount)) {
                    alert("Zadejte číslo!");
                    return;
                }
                if (amount <= 0) {
                    alert("To je málo.");
                    return;
                }
                const remainder = gift.price - gift.collected;
                if (amount > remainder) {
                    alert("To je moc!");
                    return;
                }
                donateToGift(giftId, gift, amount);
            };
            modalSubmit.onclick = sendFn;
        } else {
            modalHeader.innerText = `Opravdu nám chceš dát ${gift.modal}?`;
            modalSubmit.onclick = () => {
                takeGift(giftId);
            };
        }
    }

    function hideModal() {
        modal.style.display = "none";
        document.body.classList.remove("body-modal-open");
    }
</script>
</body>
</html>
